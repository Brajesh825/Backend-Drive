var QRCode = require("qrcode-svg");
const path = require("path");


app.get("/createQRCode", (req, res) => {
    var text = req.query.text || "";
    try {
        if (!text) throw new Error(text);

        // Make ID
        var result = "";
        var characters =
            "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
        var charactersLength = characters.length;
        for (var i = 0; i < charactersLength; i++) {
            result += characters.charAt(Math.floor(Math.random() * charactersLength));
        }
        result += ".svg";

        var qrcode = new QRCode({
            content: text,
            padding: 4,
            width: 256,
            height: 256,
            color: "blue",
            background: "#FFFFFF",
            ecl: "M",
        });
        qrcode.save(result, function(error) {
            if (error) throw error;
            let filePath = path.join(__dirname, "..", result);
            res.download(filePath);
        });
    } catch (e) {
        console.log(e);
    }
});